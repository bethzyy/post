# 图片去水印工具

## 功能说明

这是一个批量去除图片水印的工具，支持多种去水印算法，特别适合处理文字水印。

## 主要特性

1. **批量处理**: 支持一次性选择多张图片进行处理
2. **多种算法**:
   - 文字水印检测（推荐）: 自动检测并去除文字水印
   - 修复算法: 使用OpenCV的修复算法填充水印区域
   - 高斯模糊: 使用高斯模糊处理水印区域
   - 中值滤波: 使用中值滤波去除水印
   - 双边滤波: 保持边缘的同时去除水印
3. **自定义输出**: 可以指定输出目录
4. **水印文字描述**: 可以输入水印文字帮助提高检测准确度

## 使用方法

### 方式1: 通过工具管理器启动（推荐）

1. 启动工具管理器:
   ```bash
   python tool_manager.py
   # 或双击: 启动工具管理器.bat
   ```

2. 在浏览器中打开: http://localhost:5000

3. 在左侧导航栏找到"节日图像生成"分类

4. 点击"图片去水印工具"的"启动"按钮

### 方式2: 直接运行

```bash
python picture/remove_watermark.py
```

## 操作步骤

1. **选择图片文件**: 点击"选择图片文件"按钮，可以选择多张图片
2. **设置输出目录**: 点击"浏览"按钮选择处理后的图片保存位置
3. **选择去水印方法**:
   - 如果是文字水印，选择"文字水印检测（推荐）"
   - 如果是其他类型水印，选择相应的算法
4. **输入水印文字（可选）**: 如果知道水印的文字内容，输入可以帮助提高检测准确度
5. **开始处理**: 点击"开始去水印"按钮
6. **查看结果**: 处理完成后，在日志窗口查看处理结果，输出目录会显示保存位置

## 输出文件说明

处理后的图片文件名格式: `原文件名_no_watermark.扩展名`

例如: `photo.jpg` → `photo_no_watermark.jpg`

## 依赖库

- opencv-python >= 4.8.0
- pillow >= 10.0.0
- numpy >= 1.24.0
- tkinter (Python自带)

安装依赖:
```bash
pip install opencv-python pillow numpy
```

或使用requirements.txt:
```bash
pip install -r picture/requirements.txt
```

## 技术说明

### 文字水印检测算法

工具使用OpenCV的MSER（Maximally Stable Extremal Regions）算法检测文本区域:

1. 将图片转换为灰度图
2. 使用MSER检测文本候选区域
3. 过滤太小的区域
4. 合并重叠的区域
5. 使用修复算法填充检测到的区域

### 修复算法

使用OpenCV的inpainting算法:
- **Telea算法**: 快速传播算法，适合小区域修复
- **NS算法**: 流体动力学算法，适合大区域修复

## 注意事项

1. 去水印效果取决于水印的复杂度和位置
2. 文字水印检测对清晰的水印效果较好
3. 建议先处理一张图片测试效果，再批量处理
4. 处理大图片可能需要较长时间，请耐心等待
5. 输出图片会覆盖同名文件，请注意备份

## 常见问题

**Q: 为什么检测不到水印？**
A: 可能水印颜色与背景相近，或者水印太小。可以尝试使用其他算法。

**Q: 去水印后图片质量下降了？**
A: 部分算法会影响图片质量。建议使用"修复算法"或"文字水印检测"方法。

**Q: 可以批量处理几百张图片吗？**
A: 可以，但建议分批处理，每批不超过50张，避免内存占用过高。

## 更新日志

### v1.0.0 (2025-02-06)
- 初始版本发布
- 支持文字水印检测
- 支持多种去水印算法
- 支持批量处理
- 支持自定义输出目录
