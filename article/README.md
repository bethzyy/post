# 今日头条文章生成器 v3.1

## 📖 功能简介

这是一个基于AI的今日头条文章生成工具,支持:

- ✅ **主题生成** - AI从零开始创作文章
- ✅ **草稿完善** - AI优化和完善您的草稿
- ✅ **智能配图** - 自动为文章生成相关配图
- ✅ **多种风格** - 支持资深写手、通俗易懂等多种写作风格
- ✅ **一键发布** - 生成可直接发表的HTML文件

## 🎯 主要特性

### 1. 双模式生成

#### 模式一: 主题生成
- 输入文章主题,AI从零开始创作
- 支持自定义字数(1500/2000/2500字)
- 自动生成吸引人的标题
- 内容原创,逻辑清晰

#### 模式二: 草稿完善
- 支持上传草稿文件或直接粘贴
- AI保留原文核心,优化表达
- 扩展细节,增加案例
- 提升文章深度和可读性

### 2. 智能配图系统

工具内置**5个备用图片API**,按优先级自动尝试,确保配图生成成功率100%。

#### 免费图片API(默认使用,无需配置)

| 优先级 | API | 特点 | 适用场景 |
|--------|-----|------|---------|
| 1️⃣ | **Pollinations.ai** | AI智能生成,完全根据提示词 | ⭐⭐⭐⭐⭐ 最推荐 |
| 2️⃣ | **Unsplash** | 专业摄影师高质量图片 | 真实照片、艺术感 |
| 3️⃣ | **Pexels** | 免费高质量图库 | 商业友好、无需署名 |
| 4️⃣ | **LoremFlickr** | 基于关键词的真实照片 | 中等质量、真实场景 |
| 5️⃣ | **Picsum** | 随机高质量图片 | 保底方案、100%可用 |

**工作流程:**
```
开始生成图片
    ↓
尝试API 1 (Pollinations.ai) ← 最智能
    ↓ (失败)
尝试API 2 (Unsplash)
    ↓ (失败)
尝试API 3 (Pexels)
    ↓ (失败)
尝试API 4 (LoremFlickr)
    ↓ (失败)
尝试API 5 (Picsum) ← 保底成功
    ↓
图片生成成功!
```

#### 付费图片API(可选,需配置API Key)

如需更高质量的图片,可配置以下付费API:

| API | 质量评级 | 特点 | 配置要求 |
|-----|---------|------|---------|
| **DALL-E 3** | ⭐⭐⭐⭐⭐ | OpenAI最新模型,质量极高 | 需要`OPENAI_API_KEY` |
| **DALL-E 2** | ⭐⭐⭐⭐ | OpenAI经典模型 | 需要`OPENAI_API_KEY` |
| **Flux 1.1 Pro** | ⭐⭐⭐⭐ | Black Forest Labs最新模型 | 需要Anti-gravity API |
| **Stable Diffusion 3** | ⭐⭐⭐⭐ | Stability AI最新SD模型 | 需要Anti-gravity API |
| **Seedream** | ⭐⭐⭐⭐ | 豆包图灵,中国风格 | 需要`VOLCANO_API_KEY` |

**配置方法:**
在项目根目录创建`.env`文件,添加对应的API Key:
```bash
# OpenAI API (用于DALL-E)
OPENAI_API_KEY=sk-your-key-here

# Volcano API (用于Seedream)
VOLCANO_API_KEY=your-volcano-key-here

# Anti-gravity API (用于Flux/SD)
ANTIGRAVITY_API_KEY=your-antigravity-key-here
```

### 3. 配图风格选择

支持5种配图风格:

1. **自动 (auto)** - AI根据文章内容智能选择 ⭐推荐
2. **真实照片 (realistic)** - 真实照片风格
3. **艺术创作 (artistic)** - 艺术插画风格
4. **卡通插画 (cartoon)** - 卡通漫画风格
5. **技术图表 (technical)** - 流程图/架构图(仅限技术文章)

### 4. 图片插入策略

采用**资深编辑原则**,确保配图自然、不突兀:

#### 📐 资深编辑原则

1. **先文后图** - 读者需要先了解背景,再看到配图
2. **避免突兀** - 文章开头不直接插入配图
3. **自然过渡** - 配图出现在文字描述之后
4. **画龙点睛** - 配图作为对文字的视觉化补充

#### 🔍 具体策略

- **开头位置**: 至少等待2-3段内容后再插入第一张配图(或总段数的20%)
- **中间位置**: 在文章中后部(40%处)插入
- **结尾位置**: 在倒数1-2段插入

### 5. 文章输出格式

- **HTML文件** - 包含完整排版和配图,可直接复制到今日头条等平台
- **内容纯净** - 无任何元数据(主题、字数、生成时间等),可直接发表
- **专业排版** - 优化字体、颜色、行距,阅读体验佳

## 🚀 使用方法

### 方法一: Web界面(推荐)

1. 启动工具管理器:
```bash
python tool_manager.py
```

2. 浏览器访问: `http://localhost:5000`

3. 找到"今日头条文章生成器 v3.1"

4. 填写参数:
   - 选择生成模式(主题生成/草稿完善)
   - 输入主题或草稿文件路径
   - 选择目标字数
   - 选择是否生成配图
   - 选择配图风格

5. 点击"运行工具"

6. 等待生成完成,浏览器会自动打开生成的HTML文件

### 方法二: 命令行

```bash
cd article
python toutiao_article_generator.py
```

按照提示选择模式和输入参数。

## 📁 文件说明

### 输入文件

- `article/draft.txt` - 草稿文件(草稿完善模式使用)

### 输出文件

- `文章草稿完善_主题_时间戳.html` - HTML格式文章(含配图)
- `文章配图1_描述_时间戳.jpg` - 生成的配图文件

所有文件保存在`article/`目录下。

## ⚙️ 配置选项

### 写作风格

- **资深写手风格** - 语言优美,有深度,适合专栏
- **通俗易懂风格** - 接地气,有感染力,适合大众阅读

### 目标字数

- 1500字 - 快速阅读
- 2000字 - 标准长度(推荐)
- 2500字 - 深度文章

### 配图风格

详见上文"配图风格选择"部分。

## 🎨 配图生成详情

### AI智能分析

工具使用GLM-4 Flash模型分析文章内容,自动规划3张配图的:

1. **插入位置** - 开头/中间/结尾
2. **图片主题** - 根据段落内容生成提示词
3. **图片描述** - 生成中文描述

### 多API自动重试

- 自动尝试5个免费API
- SSL验证绕过(解决403错误)
- 文件大小验证(确保成功下载)
- 详细日志输出

### 配图示例

**文章主题**: OpenClaw AI框架

**生成的配图**:
1. 配图1(开头): "超级大脑" - 展示AI框架的核心概念
2. 配图2(中间): "成本警示" - 可视化API调用成本
3. 配图3(结尾): "技能插件市场" - 展示生态系统

## 🔧 常见问题

### Q1: 为什么生成的文章中没有图片?

**A**: 请检查:
1. 生成时是否选择了"生成配图: 是"
2. 查看控制台日志,确认配图生成是否成功
3. 如果显示"配图生成失败",可能是网络问题,重试即可

### Q2: 配图质量不满意怎么办?

**A**: 可以:
1. 选择不同的配图风格
2. 配置付费API(如DALL-E 3)获得更高质量
3. 重新生成,系统会使用不同的随机seed

### Q3: 可以使用自己的图片吗?

**A**: 目前版本自动生成配图。手动替换:
1. 打开生成的HTML文件
2. 找到`<img src="...">`标签
3. 替换`src`属性为您自己的图片路径

### Q4: 图片生成失败怎么办?

**A**: 系统有5个备用API,至少有一个会成功。如果全部失败:
1. 检查网络连接
2. 查看控制台错误日志
3. 重启工具管理器重试

### Q5: 如何只生成文章不生成配图?

**A**: 在参数选择中选择"生成配图: 否"即可。

## 📊 技术架构

### 技术栈

- **后端**: Python 3.8+
- **AI模型**: ZhipuAI GLM-4 Flash (文本生成)
- **图片API**: Pollinations.ai, Unsplash, Pexels等
- **Web框架**: Flask
- **前端**: HTML + CSS + JavaScript

### 核心组件

1. **ArticleGenerator** - 文章生成引擎
   - `generate_article()` - 主题生成
   - `improve_article_draft()` - 草稿完善

2. **ImageGenerator** - 配图生成引擎
   - `generate_article_images()` - 批量生成配图
   - `_analyze_content_for_images()` - AI分析内容
   - `_insert_images_into_content()` - 智能插入配图

3. **WebInterface** - Web界面
   - `tool_manager.py` - Flask服务器
   - `tool_manager.html` - 前端界面

## 🔄 更新日志

### v3.1 (2026-02-03)

- ✅ 修复粗体字样式问题(大段粗体→正常加粗)
- ✅ 移除文章元数据(生成可直接发表的文章)
- ✅ 改进图片插入策略(资深编辑原则)
- ✅ 添加5个备用图片API(100%可用率)
- ✅ 添加参数记忆功能(localStorage)
- ✅ 只生成HTML文件(不再生成Markdown)

### v3.0 (2026-01-XX)

- ✅ 支持主题生成和草稿完善双模式
- ✅ AI智能配图规划
- ✅ 多种配图风格选择
- ✅ Web界面管理

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request!

## 📮 联系方式

如有问题或建议,请在GitHub提Issue。
