# è§†é¢‘ä¸‹è½½å·¥å…·é›†æˆ - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„æ‰€æœ‰å·¥ä½œ

### 1. ç›®å½•ç»“æ„åˆ›å»º
```
C:\D\CAIE_tool\MyAIProduct\post\
â”œâ”€â”€ video/                          # æ–°åˆ›å»º
â”‚   â”œâ”€â”€ baidu_video_downloader.py   # ä»article/å¤åˆ¶è¿‡æ¥
â”‚   â””â”€â”€ è§†é¢‘ä¸‹è½½å·¥å…·é›†æˆè¯´æ˜.md      # é›†æˆæ–‡æ¡£
â”œâ”€â”€ tool_manager.py                 # å·²æ›´æ–°
â””â”€â”€ templates/
    â””â”€â”€ tool_manager.html           # å·²æ›´æ–°
```

### 2. å·¥å…·ç®¡ç†å™¨æ›´æ–°

#### æ·»åŠ videoåˆ†ç±»
```python
categories = {
    "bird": "é¸Ÿç±»ç»˜ç”»å·¥å…·",
    "picture": "èŠ‚æ—¥å›¾åƒç”Ÿæˆ",
    "article": "æ–‡ç« ç”Ÿæˆå·¥å…·",
    "video": "è§†é¢‘ä¸‹è½½å·¥å…·",        # æ–°å¢
    "hotspot": "AIçƒ­ç‚¹ç ”ç©¶",
    "test": "æµ‹è¯•å·¥å…·"
}
```

#### æ·»åŠ å·¥å…·é…ç½®
```python
"video/": {
    "baidu_video_downloader.py": {
        "description": "ä¸‹è½½å™¨ - ç™¾åº¦è§†é¢‘ä¸‹è½½å·¥å…· v2.0 (Seleniumå¢å¼ºç‰ˆ,æ”¯æŒç»•è¿‡å®‰å…¨éªŒè¯)",
        "needs_input": True,
        "input_fields": [
            {
                "name": "url",
                "label": "è§†é¢‘URL",
                "type": "text",
                "placeholder": "å¦‚: https://mbd.baidu.com/newspaper/data/videolanding?nid=...",
                "required": True
            },
            {
                "name": "output_filename",
                "label": "è¾“å‡ºæ–‡ä»¶å",
                "type": "text",
                "placeholder": "å¦‚: video.mp4 (ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ)",
                "required": False
            }
        ]
    },
}
```

### 3. åç«¯APIæ›´æ–°

#### å‚æ•°å¤„ç†è·¯ç”±
åœ¨ `/api/run` è·¯ç”±ä¸­æ·»åŠ äº†ç™¾åº¦è§†é¢‘ä¸‹è½½å™¨çš„å¤„ç†é€»è¾‘:
```python
elif filename == 'video/baidu_video_downloader.py':
    params = data.get('params', {})
    url = params.get('url', '')
    output_filename = params.get('output_filename', '')

    if not url:
        return jsonify({'success': False, 'error': 'è§†é¢‘URLä¸èƒ½ä¸ºç©º'})

    # åˆ›å»ºä¸´æ—¶è¾“å…¥æ–‡ä»¶,é€šè¿‡stdinä¼ é€’å‚æ•°
    with tempfile.NamedTemporaryFile(mode='w+', delete=False, suffix='.txt', encoding='utf-8') as f:
        f.write(url + '\n')
        f.write(output_filename + '\n')
        temp_file = f.name

    process = subprocess.Popen(
        ['python', str(tool_path)],
        stdin=open(temp_file, 'r', encoding='utf-8'),
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        cwd=BASE_DIR,
        env=env
    )
```

### 4. å‰ç«¯ç•Œé¢æ›´æ–°

#### å‚æ•°æ”¶é›†å’ŒéªŒè¯
åœ¨ `runTool()` å‡½æ•°ä¸­æ·»åŠ :
```javascript
// å¦‚æœæ˜¯ç™¾åº¦è§†é¢‘ä¸‹è½½å™¨,è·å–URLå’Œè¾“å‡ºæ–‡ä»¶å
if (currentTool.filename === 'video/baidu_video_downloader.py') {
    const url = document.getElementById('param-url').value;
    const outputFilename = document.getElementById('param-output_filename').value;

    if (!url) {
        addLog('error', 'è¯·è¾“å…¥è§†é¢‘URL');
        btn.disabled = false;
        btn.textContent = 'â–¶ï¸ è¿è¡Œå·¥å…·';
        btn.classList.remove('running');
        return;
    }

    requestData.params = {
        url: url,
        output_filename: outputFilename
    };
    addLog('info', `è§†é¢‘URL: ${url}`);
    if (outputFilename) {
        addLog('info', `è¾“å‡ºæ–‡ä»¶: ${outputFilename}`);
    } else {
        addLog('info', `è¾“å‡ºæ–‡ä»¶: è‡ªåŠ¨ç”Ÿæˆ`);
    }
}
```

### 5. å·¥å…·è„šæœ¬æ›´æ–°

#### æ”¯æŒstdinè¾“å…¥æ¨¡å¼
åœ¨ `baidu_video_downloader.py` çš„ `main()` å‡½æ•°ä¸­æ·»åŠ :
```python
# æ£€æŸ¥æ˜¯å¦æœ‰æ ‡å‡†è¾“å…¥(ä»Webç•Œé¢è°ƒç”¨)
web_mode = not sys.stdin.isatty()

if web_mode:
    # Webæ¨¡å¼ - ä»ç®¡é“è¯»å–å‚æ•°
    url = sys.stdin.readline().strip()
    output_filename = sys.stdin.readline().strip()

    if not url:
        print("\n[é”™è¯¯] æœªæ¥æ”¶åˆ°è§†é¢‘URL")
        return

    print(f"[Webæ¨¡å¼] URL: {url}")
    if output_filename:
        print(f"[Webæ¨¡å¼] è¾“å‡ºæ–‡ä»¶: {output_filename}")
    else:
        print(f"[Webæ¨¡å¼] è¾“å‡ºæ–‡ä»¶: è‡ªåŠ¨ç”Ÿæˆ")

    # æ‰§è¡Œä¸‹è½½...
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### Webç•Œé¢åŠŸèƒ½
1. **å‚æ•°è¾“å…¥è¡¨å•**
   - è§†é¢‘URLè¾“å…¥æ¡† (å¿…å¡«)
   - è¾“å‡ºæ–‡ä»¶åè¾“å…¥æ¡† (å¯é€‰)

2. **å®æ—¶æ—¥å¿—æ˜¾ç¤º**
   - æ˜¾ç¤ºè¾“å…¥çš„å‚æ•°
   - æ˜¾ç¤ºSeleniumå¯åŠ¨ä¿¡æ¯
   - æ˜¾ç¤ºä¸‹è½½è¿›åº¦

3. **é”™è¯¯å¤„ç†**
   - URLä¸ºç©ºæ—¶é˜»æ­¢è¿è¡Œ
   - æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### åç«¯åŠŸèƒ½
1. **å‚æ•°éªŒè¯**
   - æ£€æŸ¥URLæ˜¯å¦ä¸ºç©º
   - è¿”å›é”™è¯¯æç¤º

2. **å‚æ•°ä¼ é€’**
   - é€šè¿‡ä¸´æ—¶æ–‡ä»¶ä¼ é€’
   - ä½¿ç”¨stdinä¼ é€’ç»™Pythonè„šæœ¬

3. **è¿›ç¨‹ç®¡ç†**
   - å¼‚æ­¥æ‰§è¡Œä¸‹è½½
   - çŠ¶æ€æ£€æŸ¥æ¥å£

## ğŸ“± ä½¿ç”¨æµç¨‹

### å®Œæ•´çš„ä½¿ç”¨æµç¨‹
```
1. æ‰“å¼€æµè§ˆå™¨
   http://localhost:5000

2. å¯¼èˆªåˆ°å·¥å…·
   å·¦ä¾§æ ‘ â†’ è§†é¢‘ä¸‹è½½å·¥å…· â†’ baidu_video_downloader.py

3. è¾“å…¥å‚æ•°
   è§†é¢‘URL: https://mbd.baidu.com/...
   è¾“å‡ºæ–‡ä»¶å: video.mp4 (æˆ–ç•™ç©º)

4. è¿è¡Œå·¥å…·
   ç‚¹å‡»"â–¶ï¸ è¿è¡Œå·¥å…·"æŒ‰é’®

5. æŸ¥çœ‹æ—¥å¿—
   [info] è§†é¢‘URL: ...
   [info] è¾“å‡ºæ–‡ä»¶: video.mp4
   [Selenium] æ­£åœ¨å¯åŠ¨æµè§ˆå™¨...
   [ä¸‹è½½] å¼€å§‹ä¸‹è½½è§†é¢‘...
   [è¿›åº¦] 100%
   [æˆåŠŸ] è§†é¢‘ä¸‹è½½å®Œæˆ!

6. æŸ¥æ‰¾æ–‡ä»¶
   è§†é¢‘æ–‡ä»¶ä¿å­˜åœ¨: video/video.mp4
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

### å‰ç«¯ â†’ åç«¯ â†’ å·¥å…·è„šæœ¬

```
Webç•Œé¢ (tool_manager.html)
    â†“ ç”¨æˆ·è¾“å…¥å‚æ•°
JavaScriptæ”¶é›†å‚æ•°
    â†“ POST /api/run
Flaskåç«¯ (tool_manager.py)
    â†“ æ¥æ”¶å‚æ•°
åˆ›å»ºä¸´æ—¶æ–‡ä»¶
    â†“ subprocess + stdin
Pythonè„šæœ¬ (baidu_video_downloader.py)
    â†“ è¯»å–stdinå‚æ•°
å¯åŠ¨Selenium
    â†“ ä¸‹è½½è§†é¢‘
ä¿å­˜æ–‡ä»¶
```

### æ•°æ®æµå‘
```
ç”¨æˆ·è¾“å…¥ â†’ JavaScriptå¯¹è±¡ â†’ JSON â†’ Flask â†’ ä¸´æ—¶æ–‡ä»¶ â†’ stdin â†’ Pythonè„šæœ¬ â†’ ä¸‹è½½è§†é¢‘
```

## ğŸ“Š æ”¹è¿›å¯¹æ¯”

| é¡¹ç›® | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| å·¥å…·ä½ç½® | articleç›®å½• | videoç›®å½• |
| å·¥å…·ç®¡ç†å™¨ | ä¸åŒ…å« | åŒ…å« |
| Webç•Œé¢ | æ— å‚æ•°è¾“å…¥ | å®Œæ•´å‚æ•°è¡¨å• |
| å‚æ•°ä¼ é€’ | ä»…å‘½ä»¤è¡Œ | Web + å‘½ä»¤è¡Œ |
| ç”¨æˆ·ä½“éªŒ | éœ€è¦å‘½ä»¤è¡Œ | Webç•Œé¢æ“ä½œ |

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

ç°åœ¨å¯ä»¥é€šè¿‡Webç•Œé¢æ–¹ä¾¿åœ°ä½¿ç”¨ç™¾åº¦è§†é¢‘ä¸‹è½½å·¥å…·:
- âœ… æ— éœ€å‘½ä»¤è¡Œæ“ä½œ
- âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢
- âœ… å®æ—¶æ—¥å¿—åé¦ˆ
- âœ… è¿›åº¦è·Ÿè¸ª
- âœ… é”™è¯¯æç¤º

FlaskæœåŠ¡å™¨å·²è‡ªåŠ¨é‡è½½æ‰€æœ‰æ›´æ”¹,åˆ·æ–°æµè§ˆå™¨å³å¯çœ‹åˆ°æ–°çš„"è§†é¢‘ä¸‹è½½å·¥å…·"åˆ†ç±»å’Œç™¾åº¦è§†é¢‘ä¸‹è½½å·¥å…·!

---

**å®Œæˆæ—¥æœŸ**: 2026-01-29
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å®Œæˆ
