# å·¥å…·æ–‡ä»¶ä¿å­˜ä½ç½®ç»Ÿä¸€ä¿®å¤

## ğŸ“… ä¿®å¤æ—¥æœŸ
2026å¹´1æœˆ29æ—¥ 20:15

## ğŸ› é—®é¢˜æè¿°

### ç”¨æˆ·éœ€æ±‚
æ¯ä¸ªå·¥å…·ç”Ÿæˆçš„æ–‡ä»¶,**ç¼ºçœéƒ½è¦æ”¾åœ¨å·¥å…·æ‰€åœ¨çš„å­ç›®å½•ä¸‹**,é™¤éç”¨æˆ·æŒ‡å®šäº†ä¸åŒçš„ç›®å½•ã€‚

### ä¿®å¤å‰çš„é—®é¢˜
æ‰€æœ‰å·¥å…·éƒ½å°†æ–‡ä»¶ä¿å­˜åˆ°**å½“å‰å·¥ä½œç›®å½•**(`post/ç›®å½•`),è€Œä¸æ˜¯**å·¥å…·æ‰€åœ¨ç›®å½•**,å¯¼è‡´:
- æ–‡ä»¶æ•£è½åœ¨ä¸»ç›®å½•,éš¾ä»¥ç®¡ç†
- ä¸åŒå·¥å…·çš„æ–‡ä»¶æ··åœ¨ä¸€èµ·
- ä¸ç¬¦åˆæ¨¡å—åŒ–è®¾è®¡åŸåˆ™

**é—®é¢˜ç¤ºä¾‹:**
```
C:\D\CAIE_tool\MyAIProduct\post\
â”œâ”€â”€ mda-rgtd15pn4bggw00h.mp4          âŒ è§†é¢‘ä¸‹è½½åˆ°postç›®å½•
â”œâ”€â”€ ä»Šæ—¥å¤´æ¡æ–‡ç« _xxx.md                 âŒ æ–‡ç« ä¿å­˜åˆ°postç›®å½•
â”œâ”€â”€ æ–‡ç« é…å›¾1_xxx.jpg                  âŒ é…å›¾ä¿å­˜åˆ°postç›®å½•
â”œâ”€â”€ article\
â”‚   â””â”€â”€ toutiao_article_generator.py   âœ… å·¥å…·åœ¨articleç›®å½•
â””â”€â”€ video\
    â””â”€â”€ baidu_video_downloader.py      âœ… å·¥å…·åœ¨videoç›®å½•
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ç»Ÿä¸€åŸåˆ™
**ç¼ºçœæ–‡ä»¶ä¿å­˜ä½ç½® = å·¥å…·æ‰€åœ¨ç›®å½•**

ä½¿ç”¨`Path(__file__).parent`è·å–å·¥å…·æ‰€åœ¨ç›®å½•,ç„¶åæ‹¼æ¥æ–‡ä»¶åã€‚

### ä¿®å¤çš„æ–‡ä»¶

#### 1. `video/baidu_video_downloader.py`

**ä¿®æ”¹ä½ç½®:** `download_video()` æ–¹æ³• (Line 244-262)

**ä¿®æ”¹å†…å®¹:**
```python
# âœ… ä¿®å¤å
def download_video(self, video_url, output_filename=None):
    """ä¸‹è½½è§†é¢‘æ–‡ä»¶"""

    if not output_filename:
        parsed_url = urlparse(video_url)
        filename = os.path.basename(parsed_url.path)
        if not filename or '.' not in filename:
            filename = f"baidu_video_{int(time.time())}.mp4"
        output_filename = filename

    # âœ… å¦‚æœæ–‡ä»¶åä¸åŒ…å«è·¯å¾„,ä¿å­˜åˆ°å·¥å…·æ‰€åœ¨ç›®å½•
    if not os.path.isabs(output_filename) and os.path.dirname(output_filename) == '':
        # è·å–å·¥å…·æ‰€åœ¨ç›®å½•
        tool_dir = Path(__file__).parent
        output_filename = str(tool_dir / output_filename)
        print(f"[ä¿¡æ¯] ä¿å­˜ä½ç½®: {output_filename}")

    print(f"\n[ä¸‹è½½] å¼€å§‹ä¸‹è½½è§†é¢‘...")
    print(f"[ä¿å­˜] {output_filename}\n")
```

**ä¿®å¤æ•ˆæœ:**
```
# ä¿®å¤å‰
post/mda-rgtd15pn4bggw00h.mp4  âŒ

# ä¿®å¤å
post/video/mda-rgtd15pn4bggw00h.mp4  âœ…
```

**ç”¨æˆ·æŒ‡å®šè·¯å¾„:**
```python
# ç”¨æˆ·æŒ‡å®šç»å¯¹è·¯å¾„ â†’ ä¿å­˜åˆ°æŒ‡å®šä½ç½®
download_video(url, "D:/videos/my_video.mp4")

# ç”¨æˆ·æŒ‡å®šç›¸å¯¹è·¯å¾„ â†’ ä¿å­˜åˆ°å½“å‰å·¥ä½œç›®å½•
download_video(url, "../output/video.mp4")

# ç”¨æˆ·åªæŒ‡å®šæ–‡ä»¶å â†’ ä¿å­˜åˆ°å·¥å…·ç›®å½•(video/)
download_video(url, "video.mp4")
```

#### 2. `article/toutiao_article_generator.py`

**ä¿®æ”¹ä½ç½®1:** é…å›¾ç”Ÿæˆ (Line 139-150)

**ä¿®æ”¹å†…å®¹:**
```python
# âœ… ä¿®å¤å
if hasattr(img_data, 'b64_json') and img_data.b64_json:
    img_bytes = base64.b64decode(img_data.b64_json)
    img = Image.open(io.BytesIO(img_bytes))

    # ä¿å­˜å›¾ç‰‡åˆ°å·¥å…·æ‰€åœ¨ç›®å½•
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
    filename = f"æ–‡ç« é…å›¾{i}_{img_desc}_{timestamp}.jpg"

    # âœ… è·å–å·¥å…·æ‰€åœ¨ç›®å½•
    from pathlib import Path
    tool_dir = Path(__file__).parent
    img_path = str(tool_dir / filename)

    img.save(img_path, 'JPEG', quality=95)
    generated_images.append(img_path)
    print(f"    [æˆåŠŸ] {img_path}")
```

**ä¿®æ”¹ä½ç½®2:** æ–‡ç« ä¿å­˜ (Line 632-668)

**ä¿®æ”¹å†…å®¹:**
```python
# âœ… ä¿®å¤å
# ä¿å­˜ä¸ºMarkdownæ–‡ä»¶
timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
md_filename = f"ä»Šæ—¥å¤´æ¡æ–‡ç« _{theme}_{timestamp}.md"

# âœ… ä¿å­˜åˆ°å·¥å…·æ‰€åœ¨ç›®å½•
tool_dir = Path(__file__).parent
md_path = str(tool_dir / md_filename)

md_content = f"""# {article['title']}
...
"""

with open(md_path, 'w', encoding='utf-8') as f:
    f.write(md_content)

print(f"\nâœ… Markdownæ–‡ä»¶å·²ä¿å­˜: {md_path}")

# âœ… ä¿å­˜ä¸ºHTMLæ–‡ä»¶
html_filename = f"ä»Šæ—¥å¤´æ¡æ–‡ç« _{theme}_{timestamp}.html"
html_path = str(tool_dir / html_filename)
html_content = generator.create_article_html(article['title'], article['content'], theme, generated_images)

with open(html_path, 'w', encoding='utf-8') as f:
    f.write(html_content)

print(f"âœ… HTMLæ–‡ä»¶å·²ä¿å­˜: {html_path}")

# è‡ªåŠ¨æ‰“å¼€HTMLæ–‡ä»¶
webbrowser.open(f'file:///{os.path.abspath(html_path)}'.replace('\\', '/'))
```

**ä¿®å¤æ•ˆæœ:**
```
# ä¿®å¤å‰
post/ä»Šæ—¥å¤´æ¡æ–‡ç« _xxx.md       âŒ
post/ä»Šæ—¥å¤´æ¡æ–‡ç« _xxx.html      âŒ
post/æ–‡ç« é…å›¾1_xxx.jpg         âŒ

# ä¿®å¤å
post/article/ä»Šæ—¥å¤´æ¡æ–‡ç« _xxx.md      âœ…
post/article/ä»Šæ—¥å¤´æ¡æ–‡ç« _xxx.html     âœ…
post/article/æ–‡ç« é…å›¾1_xxx.jpg        âœ…
```

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| å·¥å…· | ä¿®å¤å‰ä½ç½® | ä¿®å¤åä½ç½® |
|------|-----------|-----------|
| è§†é¢‘ä¸‹è½½å™¨ | `post/è§†é¢‘.mp4` | `post/video/è§†é¢‘.mp4` |
| æ–‡ç« ç”Ÿæˆå™¨ | `post/æ–‡ç« .md` | `post/article/æ–‡ç« .md` |
| é…å›¾ç”Ÿæˆ | `post/é…å›¾.jpg` | `post/article/é…å›¾.jpg` |

## ğŸ¯ ç»Ÿä¸€è§„åˆ™

### æ–‡ä»¶è·¯å¾„åˆ¤æ–­é€»è¾‘

```python
def get_save_path(filename):
    """ç»Ÿä¸€çš„æ–‡ä»¶è·¯å¾„å¤„ç†é€»è¾‘"""

    # 1. å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ â†’ ä½¿ç”¨ç”¨æˆ·æŒ‡å®šä½ç½®
    if os.path.isabs(filename):
        return filename

    # 2. å¦‚æœåŒ…å«è·¯å¾„(ç›¸å¯¹è·¯å¾„) â†’ ä¿å­˜åˆ°æŒ‡å®šä½ç½®
    if os.path.dirname(filename) != '':
        return filename

    # 3. å¦‚æœåªæœ‰æ–‡ä»¶å â†’ ä¿å­˜åˆ°å·¥å…·ç›®å½•
    tool_dir = Path(__file__).parent
    return str(tool_dir / filename)
```

### ç”¨æˆ·ä½¿ç”¨åœºæ™¯

```python
# åœºæ™¯1: åªæŒ‡å®šæ–‡ä»¶å(æœ€å¸¸è§)
# â†’ ä¿å­˜åˆ°å·¥å…·ç›®å½•
tool.download_video(url, "video.mp4")
# ç»“æœ: post/video/video.mp4

# åœºæ™¯2: æŒ‡å®šç›¸å¯¹è·¯å¾„
# â†’ ä¿å­˜åˆ°ç›¸å¯¹ä½ç½®
tool.download_video(url, "../output/video.mp4")
# ç»“æœ: post/output/video.mp4

# åœºæ™¯3: æŒ‡å®šç»å¯¹è·¯å¾„
# â†’ ä¿å­˜åˆ°ç”¨æˆ·æŒ‡å®šä½ç½®
tool.download_video(url, "D:/myvideos/video.mp4")
# ç»“æœ: D:/myvideos/video.mp4
```

## ğŸ“ ä¿®å¤åçš„ç›®å½•ç»“æ„

```
C:\D\CAIE_tool\MyAIProduct\post\
â”œâ”€â”€ article/
â”‚   â”œâ”€â”€ toutiao_article_generator.py
â”‚   â”œâ”€â”€ ä»Šæ—¥å¤´æ¡æ–‡ç« _äººå·¥æ™ºèƒ½_20260129_200000.md     âœ…
â”‚   â”œâ”€â”€ ä»Šæ—¥å¤´æ¡æ–‡ç« _äººå·¥æ™ºèƒ½_20260129_200000.html    âœ…
â”‚   â”œâ”€â”€ æ–‡ç« é…å›¾1_ä¸»åœºæ™¯_20260129_200000.jpg         âœ…
â”‚   â”œâ”€â”€ æ–‡ç« é…å›¾2_ç»†èŠ‚ç‰¹å†™_20260129_200000.jpg       âœ…
â”‚   â””â”€â”€ æ–‡ç« é…å›¾3_ç”Ÿæ´»åœºæ™¯_20260129_200000.jpg       âœ…
â”œâ”€â”€ video/
â”‚   â”œâ”€â”€ baidu_video_downloader.py
â”‚   â””â”€â”€ mda-rgtd15pn4bggw00h.mp4                    âœ…
â”œâ”€â”€ picture/
â”‚   â””â”€â”€ (å›¾åƒç”Ÿæˆå·¥å…·çš„æ–‡ä»¶)
â””â”€â”€ hotspot/
    â””â”€â”€ (çƒ­ç‚¹ç ”ç©¶å·¥å…·çš„æ–‡ä»¶)
```

## âœ… ä¼˜åŠ¿

### 1. æ¨¡å—åŒ–ç®¡ç†
æ¯ä¸ªå·¥å…·çš„æ–‡ä»¶éƒ½åœ¨è‡ªå·±çš„ç›®å½•ä¸‹,æ¸…æ™°æ˜äº†

### 2. æ˜“äºç»´æŠ¤
- åˆ é™¤å·¥å…·æ—¶,ç›´æ¥åˆ é™¤æ•´ä¸ªç›®å½•
- å¤‡ä»½å·¥å…·æ—¶,ç›´æ¥å¤åˆ¶æ•´ä¸ªç›®å½•
- è¿ç§»å·¥å…·æ—¶,ç›´æ¥ç§»åŠ¨æ•´ä¸ªç›®å½•

### 3. é¿å…å†²çª
ä¸åŒå·¥å…·ç”Ÿæˆçš„åŒåæ–‡ä»¶ä¸ä¼šäº’ç›¸è¦†ç›–

### 4. ç”¨æˆ·ä½“éªŒ
- ç”¨æˆ·å¯ä»¥è½»æ¾æ‰¾åˆ°æŸä¸ªå·¥å…·ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶
- ä¸ç”¨æ‹…å¿ƒæ–‡ä»¶æ•£è½åœ¨å„ä¸ªç›®å½•

## ğŸ”§ æŠ€æœ¯å®ç°

### Python Pathå¯¹è±¡

```python
from pathlib import Path

# è·å–å·¥å…·æ‰€åœ¨ç›®å½•
tool_dir = Path(__file__).parent

# æ‹¼æ¥æ–‡ä»¶å
file_path = tool_dir / "filename.ext"

# è½¬æ¢ä¸ºå­—ç¬¦ä¸²
full_path = str(file_path)
```

### Windowsè·¯å¾„å…¼å®¹

```python
# HTMLä¸­å¼•ç”¨å›¾ç‰‡(éœ€è¦æ­£æ–œæ )
webbrowser.open(f'file:///{os.path.abspath(html_path)}'.replace('\\', '/'))

# æ–‡ä»¶æ“ä½œ(Windowsè‡ªåŠ¨å¤„ç†æ–œæ )
with open(html_path, 'w') as f:  # âœ… æ”¯æŒåæ–œæ 
    f.write(content)
```

## ğŸ‰ æ€»ç»“

### ä¿®å¤å†…å®¹
1. âœ… è§†é¢‘ä¸‹è½½å™¨ - è§†é¢‘ä¿å­˜åˆ°`video/`ç›®å½•
2. âœ… æ–‡ç« ç”Ÿæˆå™¨ - æ–‡ç« ä¿å­˜åˆ°`article/`ç›®å½•
3. âœ… é…å›¾ç”Ÿæˆ - å›¾ç‰‡ä¿å­˜åˆ°`article/`ç›®å½•

### ç»Ÿä¸€åŸåˆ™
**ç¼ºçœä¿å­˜ä½ç½® = å·¥å…·æ‰€åœ¨ç›®å½•**

### ç”¨æˆ·çµæ´»æ€§
- âœ… åªæŒ‡å®šæ–‡ä»¶å â†’ ä¿å­˜åˆ°å·¥å…·ç›®å½•
- âœ… æŒ‡å®šç›¸å¯¹è·¯å¾„ â†’ ä¿å­˜åˆ°ç›¸å¯¹ä½ç½®
- âœ… æŒ‡å®šç»å¯¹è·¯å¾„ â†’ ä¿å­˜åˆ°æŒ‡å®šä½ç½®

### Flaskå·²è‡ªåŠ¨é‡è½½
æ‰€æœ‰ä¿®æ”¹å·²ç»ç”Ÿæ•ˆ,åˆ·æ–°æµè§ˆå™¨å³å¯!

---

**ä¿®å¤æ—¶é—´:** 2026-01-29 20:15
**çŠ¶æ€:** âœ… å·²ä¿®å¤
**ç‰ˆæœ¬:** v2.2
